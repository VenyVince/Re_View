<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.review.shop.repository.userinfo.user_related.WishlistMapper">

    <!-- 기존 getWishlist 유지 -->
    <select id="getWishlist" parameterType="int" resultType="com.review.shop.dto.userinfo.user_related.wishlist.WishlistDTO">
        SELECT
        w.WISH_ITEM_ID   AS wish_item_id,
        w.USER_ID        AS user_id,
        w.PRODUCT_ID     AS product_id,
        p.PRD_NAME       AS prd_name,
        p.PRD_BRAND      AS prd_brand,
        p.PRICE          AS price
        FROM WISH_ITEM w
        JOIN PRODUCT p ON w.PRODUCT_ID = p.PRODUCT_ID
        WHERE w.USER_ID = #{user_id}
        ORDER BY w.WISH_ITEM_ID DESC
    </select>

    <!-- 이미 찜했는지 확인 -->
    <select id="existsWishlistItem" resultType="boolean">
        SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
        FROM WISH_ITEM
        WHERE USER_ID = #{user_id}
        AND PRODUCT_ID = #{product_id}
    </select>

    <!-- 찜 등록: ID는 Mapper에서 생성하지 않고 그냥 INSERT -->
    <insert id="insertWishlistItem">
        INSERT INTO WISH_ITEM (USER_ID, PRODUCT_ID)
        VALUES (#{user_id}, #{product_id})
    </insert>

    <!-- 찜 삭제 -->
    <delete id="deleteWishlistItem">
        DELETE FROM WISH_ITEM
        WHERE USER_ID = #{user_id}
          AND PRODUCT_ID = #{product_id}
    </delete>
</mapper>
