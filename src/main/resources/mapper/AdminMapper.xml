<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.review.shop.repository.admin.AdminMapper">

    <insert id="insertProduct" parameterType="com.review.shop.dto.ProductDetailDTO"
            useGeneratedKeys="true">
        INSERT INTO PRODUCT (
            PRD_NAME,
            PRD_BRAND,
            INGREDIENT,
            PRICE,
            CATEGORY,
            STOCK,
            RATING,
            DESCRIPTION,
            REVIEW_COUNT,
            BAUMANN_ID
        )
        VALUES (
                   #{prdName},
                   #{prdBrand},
                   #{ingredient},
                   #{price},
                   #{category},
                   #{stock},
                   #{rating},
                   #{description},
                   #{reviewCount},
                   #{baumannId}
               )
    </insert>

    <update id="updateProduct">
        UPDATE PRODUCT
        SET
            PRD_NAME = #{product.prdName},
            PRD_BRAND = #{product.prdBrand},
            INGREDIENT = #{product.ingredient},
            PRICE = #{product.price},
            CATEGORY = #{product.category},
            STOCK = #{product.stock},
            RATING = #{product.rating},
            DESCRIPTION = #{product.description},
            REVIEW_COUNT = #{product.reviewCount},
            BAUMANN_ID = #{product.baumannId},
            IS_SOLD_OUT = #{product.isSoldOut},
            UPDATED_AT = SYSDATE
        WHERE
            PRODUCT_ID = #{productId}
    </update>

    <update id="deleteProduct">
        UPDATE PRODUCT
        SET DELETED_AT = SYSDATE
        WHERE PRODUCT_ID = #{productId}
    </update>

    <update id="updateOrderStatus">
        UPDATE ORDERS SET
                          ORDER_STATUS = #{orderStatus}
        WHERE
            ORDER_ID = #{orderId}
    </update>

    <update id="updateQnaAnswer">
        UPDATE QNA SET
                       ANSWER = #{adminAnswer},
                       ANSWERED_AT = SYSDATE WHERE
            QNA_ID = #{qnaId}
    </update>

    <select id="getMemberPoints" resultType="java.lang.Integer">
        SELECT POINT FROM USER_TABLE WHERE USER_ID = #{memberId}
    </select>

    <select id="getAllProducts" resultType="com.review.shop.dto.ProductDetailDTO">
        SELECT
            PRD_NAME        AS prdName,
            PRD_BRAND       AS prdBrand,
            INGREDIENT      AS ingredient,
            PRICE           AS price,
            CATEGORY        AS category,
            STOCK           AS stock,
            RATING          AS rating,
            DESCRIPTION     AS description,
            REVIEW_COUNT    AS reviewCount,
            BAUMANN_ID      AS baumannId,
            IS_SOLD_OUT     AS isSoldOut
        FROM
            PRODUCT
        WHERE
            DELETED_AT IS NULL
    </select>

    <update id="deleteReview" parameterType="int">
        UPDATE REVIEW
        SET DELETED_AT = SYSDATE
        WHERE REVIEW_ID = #{reviewId}
    </update>

    <update id="setReviewSelection">
        UPDATE REVIEW
        SET IS_SELECTED = #{isSelected}
        WHERE REVIEW_ID = #{reviewId}
    </update>


    <resultMap id="QnaResultMap" type="com.review.shop.dto.qna.QnADTO">
        <id property="qnaId"       column="QNA_ID" />

        <result property="productId"  column="PRODUCT_ID" />
        <result property="userId"     column="USER_ID" />
        <result property="title"      column="TITLE" />
        <result property="content"    column="CONTENT" />      <result property="answer"     column="ANSWER" />       <result property="createdAt"  column="CREATED_AT" />
        <result property="deletedAt"  column="DELETED_AT" />
        <result property="answeredAt" column="ANSWERED_AT" />
    </resultMap>

    <select id="getAllQna" resultMap="QnaResultMap">
        SELECT
            QNA_ID,
            PRODUCT_ID,
            USER_ID,
            TITLE,
            CONTENT,
            ANSWER,
            CREATED_AT,
            DELETED_AT,
            ANSWERED_AT
        FROM QNA
        WHERE DELETED_AT IS NULL
        ORDER BY CREATED_AT DESC
    </select>



</mapper>