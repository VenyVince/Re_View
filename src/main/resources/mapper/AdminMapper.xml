<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.review.shop.repository.admin.AdminMapper">

    <insert id="insertProduct" parameterType="com.review.shop.dto.ProductDetailDTO"
            useGeneratedKeys="true">
        INSERT INTO PRODUCT (
            PRD_NAME,
            PRD_BRAND,
            INGREDIENT,
            PRICE,
            CATEGORY,
            STOCK,
            RATING,
            DESCRIPTION,
            REVIEW_COUNT,
            BAUMANN_ID
        )
        VALUES (
                   #{prdName},
                   #{prdBrand},
                   #{ingredient},
                   #{price},
                   #{category},
                   #{stock},
                   #{rating},
                   #{description},
                   #{reviewCount},
                   #{baumannId}
               )
    </insert>

    <update id="updateProduct">
        UPDATE PRODUCT
        SET
            PRD_NAME = #{product.prdName},
            PRD_BRAND = #{product.prdBrand},
            INGREDIENT = #{product.ingredient},
            PRICE = #{product.price},
            CATEGORY = #{product.category},
            STOCK = #{product.stock},
            RATING = #{product.rating},
            DESCRIPTION = #{product.description},
            REVIEW_COUNT = #{product.reviewCount},
            BAUMANN_ID = #{product.baumannId},
            IS_SOLD_OUT = #{product.isSoldOut},
            UPDATED_AT = SYSDATE
        WHERE
            PRODUCT_ID = #{productId}
    </update>

    <update id="deleteProduct">
        UPDATE PRODUCT
        SET DELETED_AT = SYSDATE
        WHERE PRODUCT_ID = #{productId}
    </update>

    <update id="updateOrderStatus">
        UPDATE ORDERS SET
                          ORDER_STATUS = #{orderStatus}
        WHERE
            ORDER_ID = #{orderId}
    </update>

    <update id="updateQnaAnswer">
        UPDATE QNA SET
                       ANSWER = #{adminAnswer},
                       ANSWERED_AT = SYSDATE WHERE
            QNA_ID = #{qnaId}
    </update>

    <select id="getMemberPoints" resultType="java.lang.Integer">
        SELECT POINT FROM USER_TABLE WHERE USER_ID = #{memberId}
    </select>

    <select id="getAllProducts" resultType="com.review.shop.dto.ProductDetailDTO">
        SELECT
            PRD_NAME        AS prdName,
            PRD_BRAND       AS prdBrand,
            INGREDIENT      AS ingredient,
            PRICE           AS price,
            CATEGORY        AS category,
            STOCK           AS stock,
            RATING          AS rating,
            DESCRIPTION     AS description,
            REVIEW_COUNT    AS reviewCount,
            BAUMANN_ID      AS baumannId,
            IS_SOLD_OUT     AS isSoldOut
        FROM
            PRODUCT
        WHERE
            DELETED_AT IS NULL
    </select>

    <update id="deleteReview" parameterType="int">
        UPDATE REVIEW
        SET DELETED_AT = SYSDATE
        WHERE REVIEW_ID = #{reviewId}
    </update>

    <update id="setReviewSelection">
        UPDATE REVIEW
        SET IS_SELECTED = #{isSelected}
        WHERE REVIEW_ID = #{reviewId}
    </update>

    <select id="getAllQna" resultType="com.review.shop.dto.qna.QnAListDTO">
        SELECT
            q.QNA_ID    AS qnaId,
            q.TITLE     AS title,
            u.NAME      AS userName  FROM QNA q
                                              JOIN USER_TABLE u ON q.USER_ID = u.USER_ID
        WHERE q.DELETED_AT IS NULL
        ORDER BY q.QNA_ID DESC
    </select>

    <select id="getQnaDetail" parameterType="int" resultType="com.review.shop.dto.qna.QnADTO">
        SELECT
            q.QNA_ID      AS qnaId,
            q.PRODUCT_ID  AS productId,

            p.PRD_NAME    AS productName,
            q.USER_ID     AS userId,
            u.NAME        AS userName,
            q.TITLE       AS title,
            q.CONTENT     AS content,
            q.ANSWER      AS answer,
            q.CREATED_AT  AS createdAt,
            q.ANSWERED_AT AS answeredAt
        FROM QNA q
                 LEFT JOIN USER_TABLE u ON q.USER_ID = u.USER_ID
                 LEFT JOIN PRODUCT p ON q.PRODUCT_ID = p.PRODUCT_ID
        WHERE q.QNA_ID = #{qnaId}
    </select>


</mapper>