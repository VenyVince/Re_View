<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.review.shop.repository.admin.AdminQnAMapper">
    <update id="updateQnaAnswer">
        UPDATE QNA
        SET
            ANSWER = #{adminAnswer},
            ANSWERED_AT = SYSDATE
        WHERE
            QNA_ID = #{qna_id}
    </update>

    <select id="getAllQna" resultType="com.review.shop.dto.qna.QnAListDTO">
        SELECT
            q.QNA_ID       AS qna_id,
            q.TITLE        AS title,
            u.NAME         AS user_name,
            p.PRD_NAME     AS prd_name
        FROM QNA q
                 JOIN USER_TABLE u ON q.USER_ID = u.USER_ID
                 JOIN PRODUCT p ON q.PRODUCT_ID = p.PRODUCT_ID
        WHERE q.DELETED_AT IS NULL
        ORDER BY q.QNA_ID DESC
    </select>

    <select id="getQnaDetail" parameterType="int" resultType="com.review.shop.dto.qna.QnaDTO">
        SELECT
            q.QNA_ID,
            q.PRODUCT_ID,
            q.USER_ID,
            q.TITLE,
            q.CONTENT,
            q.ANSWER,
            q.CREATED_AT,
            q.ANSWERED_AT,
            q.DELETED_AT,
            u.NAME AS user_name,
            CASE
                WHEN q.ANSWER IS NOT NULL THEN '답변완료'
                ELSE '답변대기'
                END AS status
        FROM QNA q
                 LEFT JOIN USER_TABLE u ON q.USER_ID = u.USER_ID
                 LEFT JOIN PRODUCT p ON q.PRODUCT_ID = p.PRODUCT_ID
        WHERE q.QNA_ID = #{qna_id}
    </select>
</mapper>